---
layout: ../../layouts/tutorial/TextTutorial.astro
title: "[Korean] Cross Platform TV Application Development (1/2)"
description: "This tutorial describes the process of developing a CrossPlatform Application that works with both Tizen and Android using Xamarin.Forms.\nIt is the first of two tutorials, and it implements the function of displaying video list of VideoPlayer."
created: "2017/10/01"
modified: "undefined"
profile: ["tv"]
type: "dotnet"
level: 2
state: "open"
thumbnail: "/assets/images/tutorials/95/video1.png"
---

# I. Introduction

## 1. VideoPlayerLite 앱 개요

본 강좌에서는 [Xamarin.Forms](https://developer.xamarin.com/guides/xamarin-forms/)와 MVVM 패턴을 이용하여 간단한 비디오 플레이어 앱을 만들어보겠습니다.

우리가 만들 VideoPlayerLite 앱은 타이젠과 안드로이드를 지원하는 Cross-Platform App입니다.

<br/>VideoPlayerLite 앱은 아래와 같은 2개의 주요 페이지로 이루어져 있습니다.

<img src="/assets/images/tutorials/95/00_app_overview.png" style="height:320px; width:1150px"/>

첫번째 페이지는 비디오 파일들의 목록을 보여주는 LibraryPage이고, 두번째 페이지는 비디오를 재생하는 PlayerPage입니다.



본 강좌는 2개의 파트로 나누어져있으며 Part 1(이번 강좌)에서는 LibraryPage 구현, 그리고 Part 2에서는 PlayerPage 구현을 해볼 것입니다.

- Part 2 강좌: [Cross Platform TV Application Development (2/2)](http://tizenappschool.org/tutorial/97)



## 2. MVVM 패턴 소개

MVVM은  **M** odel- **V** iew- **V** iew **M** odel의 약자로 UI 컨트롤과 로직을 분리하고자하는 목적을 가지고 있습니다.



아래 그림은 각 컴포넌트간의 관계를 보여줍니다.

<img src="/assets/images/tutorials/95/00_MVVM_adv.png" style="height:557px; width:822px"/>



- 더 자세한 정보는 아래 링크에서 확인 가능

[The MVVM Pattern](https://msdn.microsoft.com/en-us/library/hh848246.aspx)

## 3. VideoPlayerLite 앱 구조

아래 그림은 우리가 만들게 될 VideoPlayerLite 앱의 전체적인 구조를 보여줍니다.

<img src="/assets/images/tutorials/95/00_appmodel_0_all.png" style="undefined"/>



# II. Project Initiation

## 1. Xamarin Cross-platform 프로젝트 솔루션 만들기

새로운 프로젝트 솔루션을 만들기 위하여 **파일** > **새로 만들기**  > **프로젝트** 선택

<img src="/assets/images/tutorials/95/01_01.png" style="height:251px; width:394px"/>



**Visual C#** > **Cross-Platform** 카테고리에서  **Cross Platform App (Xamarin)** 선택

프로젝트/솔루션명을 정한 후,  **OK** 클락 (본 강좌에서는 VideoPlayerLite라고 명명)

<img src="/assets/images/tutorials/95/01_02.png" style="height:392px; width:567px"/>



**Blank App** **,** UI Technology로는 **Xamarin.Forms** , 그리고 Code Sharing Strategy로는 **Portable Class Library (PCL)** 선택 후, **OK** 클릭

<img src="/assets/images/tutorials/95/01_03.png" style="height:311px; width:567px"/>



**VideoPlayer (이식 가능)** , **VideoPlayer.Android** , 그리고  **VideoPlayer.iOS** 프로젝트가 생성된 것을 확인

<img src="/assets/images/tutorials/95/01_04.png" style="height:366px; width:183px"/>



[코드 스냅샷](https://s3-us-west-1.amazonaws.com/tizenschool/95/VIdeoPlayerLite1_01_INITIAL.zip)

## 2. Tizen 프로젝트 만들기

**Step 1: Tizen 프로젝트 추가**

솔루션에 우클릭 후, **추가**  > **새 프로젝트** 선택

<img src="/assets/images/tutorials/95/02_01.png" style="height:386px; width:555px"/>



**Visual C#** > **Tizen** > **Cross-Platform** 카테고리에서  **Blank App (Xamarin.Forms)** 선택

<img src="/assets/images/tutorials/95/02_02.png" style="undefined"/>



프로젝트가 저장될 위치를 바꾸기 위하여 **찾아보기** 클릭

<img src="/assets/images/tutorials/95/02_03.png" style="undefined"/>



VideoPlayer.Android와 같은 다른 프로젝트들이 저장되어 있는 폴더를 선택

<img src="/assets/images/tutorials/95/02_04.png" style="undefined"/>



새로운 프로젝트명은 "VideoPlayerLite.Tizen"로 정한 후, **OK** 클릭

<img src="/assets/images/tutorials/95/02_05.png" style="height:391px; width:567px"/>



**TV** 프로파일 선택 후,  **OK**  클릭

<img src="/assets/images/tutorials/95/02_06.png" style="undefined"/>



**Step 2: Tizen 프로젝트 생성 확인 및 불필요 프로젝트 삭제**

새로운 프로젝트가 생성된 것을 확인

<img src="/assets/images/tutorials/95/02_08.png" style="undefined"/>



본 강좌에서는 iOS에 대한 부분은 다루지 않을 예정이므로 삭제

<img src="/assets/images/tutorials/95/03_06.png" style="height:170px; width:170px"/>



**Step 3: Build 및 기본 View 확인**

Tizen 프로젝트에 우 클릭 후, **시작 프로젝트로 설정** 선택

<img src="/assets/images/tutorials/95/05_03.png" style="height:330px; width:354px"/>



**Launch Tizen Emulator** 버튼 클릭

<img src="/assets/images/tutorials/95/05_04.png" style="height:92px; width:719px"/>



Emulator Manager 에서 **Launch** 버튼 클릭

<img src="/assets/images/tutorials/95/05_05.png" style="height:439px; width:454px"/>



Emulator가 실행되면, 프로젝트 창으로 돌아가 **ctrl + F5** 를 눌러 프로젝트 빌드

**아래 스크린이 확인되면 성공!**

<img src="/assets/images/tutorials/95/05_07.png" style="height:370px; width:756px"/>



[코드 스냅샷](https://s3-us-west-1.amazonaws.com/tizenschool/95/VideoPlayerLite1_02_Tizen_project.zip)



# III. LibraryPage View

## 1. LibraryPage View 개요

먼저 App의 제목과 그 밑에 비디오 파일들의 리스트를 Grid 형태로 보여주는 LibraryPage를 만들어보겠습니다.

<img src="/assets/images/tutorials/95/00_screen_1_librarypage.png" style="height:390px; width:601px"/>



LibraryPage View에서는 LibraryPage의 레이아웃과 스타일링을 정의합니다.

<img src="/assets/images/tutorials/95/00_appmodel_1_LibraryPageView.png" style="undefined"/>











## 2. LibraryPage View 구현

**Step 1: View 관련 폴더 및 파일 생성**

먼저 View 관련 컴포넌트들이 저장될 폴더를 생성합니다.

VideoPlayerLite project에 우 클릭 후, **추가** > **새 폴더** 선택

<img src="/assets/images/tutorials/95/04_01.png" style="undefined"/>



폴더의 이름은 "Views"로 명명

<img src="/assets/images/tutorials/95/04_02.png" style="height:252px; width:167px"/>



Views 폴더에 우 클릭 후, **추가** > **새 항목**  선택

<img src="/assets/images/tutorials/95/04_03.png" style="height:236px; width:467px"/>



Visual C# Items 중  **Content Page**  선택 후, " **LibraryPage** "라 명명하고 **Add** 클릭

<img src="/assets/images/tutorials/95/04_04.png" style="height:392px; width:567px"/>



**Step 2: XAML 관련 코드 확인**

**LibraryPage.xaml** 파일과 **LibraryPage.xaml.cs** 파일(code-behind)이 생성된 것을 확인

<img src="/assets/images/tutorials/95/04_05.png" style="height:323px; width:166px"/>



XAML(.xaml)은 마크업으로 UI 정의를 가능하게 해주며, Code-Behind(.xaml.cs)는 간단한 View Control을 가능하게 해줍니다.



- 더 자세한 정보는 아래 링크에서 확인 가능

[eXtensible Application Markup Language (XAML)](https://developer.xamarin.com/guides/xamarin-forms/xaml/)





그럼 몸풀이로 간단하게 LibraryPage 안에 표시되는 텍스트를 바꾸고 스크린에 띄워보겠습니다.



**Step 3: xaml 코드 변경**

Label 태그의 Text Property 값을 "Welcome to LibraryPage!"로 변경

_[LibraryPage.xaml]_

<highlight>7</highlight>

```xml
<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="VideoPlayerLite.Views.LibraryPage">
    <ContentPage.Content>
        <StackLayout>
            <Label Text="Welcome to LibraryPage!"
                VerticalOptions="CenterAndExpand"
                HorizontalOptions="CenterAndExpand" />
        </StackLayout>
    </ContentPage.Content>
</ContentPage>

```



**Step 4: App.xaml의 Code-Behind 변경**

App.xaml 파일 옆 확장 버튼을 클릭하여 App.xaml.cs 파일 선택

<img src="/assets/images/tutorials/95/05_01.png" style="height:324px; width:166px"/>



App의 Main Page를 새로운 LibraryPage 인스턴스로 변경

_[App.xaml.cs]_

<highlight>16</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

using Xamarin.Forms;

namespace VideoPlayerLite
{
    public partial class App : Application
    {
        public App()
        {
            InitializeComponent();

            MainPage = new LibraryPage();
        }

        protected override void OnStart()
        {
            // Handle when your app starts
        }

        protected override void OnSleep()
        {
            // Handle when your app sleeps
        }

        protected override void OnResume()
        {
            // Handle when your app resumes
        }
    }
}


```



LibraryPage 인스턴스를 찾지 못 하여 경고가 표시되면, **ctrl + .** 키를 눌러 에러 해결 (필요한 namespace를 추가)

<img src="/assets/images/tutorials/95/05_02.png" style="height:361px; width:444px"/>



*[App.xaml.cs] *final code\*\*

<highlight>5</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using VideoPlayerLite.Views;
using Xamarin.Forms;

namespace VideoPlayerLite
{
    public partial class App : Application
    {
        public App()
        {
            InitializeComponent();

            MainPage = new LibraryPage();
        }

        protected override void OnStart()
        {
            // Handle when your app starts
        }

        protected override void OnSleep()
        {
            // Handle when your app sleeps
        }

        protected override void OnResume()
        {
            // Handle when your app resumes
        }
    }
}

```



**ctrl + F5** 를 눌러 프로젝트 빌드

**아래 스크린이 확인되면 성공!**

<img src="/assets/images/tutorials/95/04_06.png" style="height:371px; width:756px"/>

## 3. LibraryPage Layout 정의

이번에는 LibraryPage.xaml의 코드를 변경하여 LibraryPage의 레이아웃을 바꿔보겠습니다.



LibraryPage는 아래 그림과 같이 App 타이틀을 표시하는  **Label** 과  **ScrollView** 내 포함된 **Grid** 로 구성되어 있습니다.

<img src="/assets/images/tutorials/95/00_screen_1_librarypage_notitle.png" style="undefined"/>



**Step 1: 제목 Label 추가**

ContentPage.Content 영역에 StackLayout을 RelativeLayout으로 변경

<img src="https://developer.xamarin.com/guides/xamarin-forms/user-interface/layouts/relative-layout/Images/Layouts.png" style="height:236px; width:700px"/>

그리고 그 안에 앱의 제목을 표시해주는 Label 추가해줍니다.

_[LibraryPage.xaml]_

<highlight>6-15</highlight>

```xml
<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="VideoPlayerLite.Views.LibraryPage">
    <ContentPage.Content>
        <RelativeLayout RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=1}"
                        RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}">
            <Label Text="Video Player Lite"
                   FontAttributes="Bold"
                   FontSize="Large"
                   HorizontalOptions="Center"
                   VerticalOptions="End"
                   RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.185}"
                   RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}"/>
        </RelativeLayout>
    </ContentPage.Content>
</ContentPage>

```

- 더 자세한 정보는 아래 링크에서 확인 가능

[Xamarin.Forms RelativeLayout](https://developer.xamarin.com/guides/xamarin-forms/user-interface/layouts/relative-layout/)

[Xamarin.Forms Label](https://developer.xamarin.com/guides/xamarin-forms/user-interface/text/label/)



**Step 2: ScrollView & Grid 추가**

RelativeLayout 안에 스크롤이 가능한 ScrollView를 추가하고, 그 안에 비디오 파일을 보여주기 위한 Grid 추가

Grid 안 3개의 RowDefinition 배치

_[LibraryPage.xaml]_

<highlight>15-28</highlight>

```xml
<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="VideoPlayerLite.Views.LibraryPage">
    <ContentPage.Content>
        <RelativeLayout RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=1}"
                        RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}">
            <Label Text="Video Player Lite"
                   FontAttributes="Bold"
                   FontSize="Large"
                   HorizontalOptions="Center"
                   VerticalOptions="End"
                   RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.185}"
                   RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}"/>
            <ScrollView RelativeLayout.YConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.3}"
                        RelativeLayout.XConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.05}"
                        RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.55}"
                        RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.95}"
                        Orientation="Horizontal">
                <Grid x:Name="GridView"
                      HorizontalOptions="Start">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                </Grid>
            </ScrollView>
        </RelativeLayout>
    </ContentPage.Content>
</ContentPage>

```

- 더 자세한 정보는 아래 링크에서 확인 가능

[Xamarin.Forms ScrollView](https://developer.xamarin.com/guides/xamarin-forms/user-interface/layouts/scroll-view/)

[Xamarin.Forms Grid](https://developer.xamarin.com/guides/xamarin-forms/user-interface/layouts/grid/)

[Xamarin.Forms RowDefinition](https://developer.xamarin.com/api/type/Xamarin.Forms.RowDefinition/)



**Step 3: BoxViews 추가**

각 열(Row)에 다른 색을 가진 BoxView 추가

***[LibraryPage.xaml] *final code\*\***

<highlight>27-32</highlight>

```xml
<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="VideoPlayerLite.Views.LibraryPage">
    <ContentPage.Content>
        <RelativeLayout RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=1}"
                        RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}">
            <Label Text="Video Player Lite"
                   FontAttributes="Bold"
                   FontSize="Large"
                   HorizontalOptions="Center"
                   VerticalOptions="End"
                   RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.185}"
                   RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}"/>
            <ScrollView RelativeLayout.YConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.3}"
                        RelativeLayout.XConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.05}"
                        RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.55}"
                        RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.95}"
                        Orientation="Horizontal">
                <Grid x:Name="GridView"
                      HorizontalOptions="Start">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <BoxView Grid.Row="0"
                             Color="Red"/>
                    <BoxView Grid.Row="1"
                             Color="White"/>
                    <BoxView Grid.Row="2"
                             Color="Blue"/>
                </Grid>
            </ScrollView>
        </RelativeLayout>
    </ContentPage.Content>
</ContentPage>

```

- 더 자세한 정보는 아래 링크에서 확인 가능

[Xamarin.Forms BoxView](https://developer.xamarin.com/api/type/Xamarin.Forms.BoxView/)



**ctrl + F5** 를 눌러 프로젝트 빌드

**아래 스크린이 확인되면 성공!**

<img src="/assets/images/tutorials/95/05_06.png" style="height:371px; width:756px"/>



[코드 스냅샷](https://s3-us-west-1.amazonaws.com/tizenschool/95/VideoPlayerLite1_03_LibraryPage_View.zip)

# IV. Application Model

## 1. App Model 개요

App Model에서는 앱의 전체적인 데이터 모델 (MediaItem) 및 비즈니스 로직들 (MediaItemProvider) 을 구현합니다.

<img src="/assets/images/tutorials/95/00_appmodel_2_0_Model.png" style="height:425px; width:1000px"/>

## 2. MediaItem 데이터 모델 구현

먼저 비디오 파일에 대한 **정보들(Title, path, thumbnail, duration)** 을 담고 있는 데이터 모델 클래스인 MediaItem을 구현합니다.

<img src="/assets/images/tutorials/95/00_appmodel_2_1_Model_MediaItem.png" style="undefined"/>



**Step 1: Model 관련 폴더 및 MediaItem 클래스 파일 생성**

VideoPlayerLite project에 우 클릭 후, **추가** > **새 폴더** 선택 ( **Models** 로 명명)

Models 폴더에 우 클릭 후, **추가** > **새 항목** 선택

**클래스** 선택 후 **추가** 클릭 ( **MediaItem.cs** 로 명명)

<img src="/assets/images/tutorials/95/06_02.png" style="height:392px; width:567px"/>

<img src="/assets/images/tutorials/95/06_01.png" style="height:324px; width:167px"/>



**Step 2: MediaItem 클래스 구현**

MediaItem을 **public** 클래스로 만들어 준 후, 4개의 필수 멤버 ( **Title** , **Path** , **Thumbnail** , **Duration** ) 추가

_[MediaItem.cs]_

<highlight>9-18</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace VideoPlayerLite.Models
{
    public class MediaItem
    {
        public string Title { get; set; }

        public string Path { get; set; }

        public string Thumbnail { get; set; }

        public int Duration { get; set; }
    }
}

```



## 3. IMediaContentAPIs Interface 정의

다음으로는 IMediaContentAPIs 인터페이스를 만들고, 그 안에 비디오 정보를 가져오기 위해 필요한 기능을 정의해주도록 하겠습니다.

<img src="/assets/images/tutorials/95/00_appmodel_2_2_Model_IMediaContentAPIs.png" style="undefined"/>



- 더 자세한 정보는 아래 링크에서 확인 가능

[인터페이스(C# 프로그래밍 가이드)](https://docs.microsoft.com/ko-kr/dotnet/csharp/programming-guide/interfaces/)



**Step 1:  IMediaContentAPIs 인터페이스 생성**

Models 폴더에 새로운 **인터페이스** 를 추가 후, " **IMediaContentAPIs.cs** "라고 명명

<img src="/assets/images/tutorials/95/07_01.png" style="height:392px; width:567px"/>

<img src="/assets/images/tutorials/95/07_02.png" style="height:323px; width:167px"/>



**Step 2: Method 추가**

IMediaContentAPIs 을 **public** 인터페이스로 만들어 준 후, MediaItem 리스트를 불러오기 위한 비동기 함수인  **GetAllVideoItemListAsync()** 정의

_[IMediaContentAPIs.cs]_

<highlight>9-12</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace VideoPlayerLite.Models
{
    public interface IMediaContentAPIs
    {
        Task<IEnumerable<MediaItem>> GetAllVideoItemListAsync();
    }
}

```

- 더 자세한 정보는 아래 링크에서 확인 가능

[Task-based Asynchronous Pattern (작업 기반 비동기 패턴)](https://docs.microsoft.com/ko-kr/dotnet/standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap)



## 4. MediaContentPort (플랫폼 별) 구현

이제 각 플랫폼의 MediaContentPort에서 IMediaContentAPIs의 정의된 기능을 실제 구현하여 비디오 정보를 가져와보겠습니다.

<img src="/assets/images/tutorials/95/00_appmodel_2_3_Model_MediaContentPort.png" style="undefined"/>



**Step 1: 각 플랫폼 내 Port 폴더 생성 및 MediaContentPort 클래스 추가**

각 플랫폼 프로젝트에서 새로운 **"Port"** 폴더 생성 후, " **MediaContentPort.cs** " 클래스 추가

<img src="/assets/images/tutorials/95/08_01.png" style="height:323px; width:167px"/>



**Step 2: IMediaContentAPIs 구현**

MediaContentPort에서 IMediaContentAPIs 인터페이스 구현

GetAllVideoItemListAsync()에서 MediaItem의 리스트인 itemList를 생성하고 return해줌

_[MediaContentPort.cs (Tizen)]_

<highlight>5-6,10-17</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using VideoPlayerLite.Models;

namespace VideoPlayerLite.Tizen.Tizen.TV.Port
{
    public class MediaContentPort : IMediaContentAPIs
    {
        public async Task<IEnumerable<MediaItem>> GetAllVideoItemListAsync()
        {
            var itemList = new List<MediaItem>();

            return itemList;
        }
    }
}

```

- 더 자세한 정보는 아래 링크에서 확인 가능

[비동기 프로그래밍](https://docs.microsoft.com/ko-kr/dotnet/csharp/async)

[async(C# 참조)](https://docs.microsoft.com/ko-kr/dotnet/csharp/language-reference/keywords/async)



**Step 3: MediaDatabase & MediaInfoCommand 인스턴스화**

Constructor에서 새로운 MediaDatabase 인스턴스 생성 후, Connect를 통해 연결

mediaDatabase에 대한 MediaInfoCommand  인스턴스 생성

_[MediaContentPort.cs (Tizen)]_

<highlight>6,13-23</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Tizen.Content.MediaContent;
using VideoPlayerLite.Models;

namespace VideoPlayerLite.Tizen.Tizen.TV.Port
{
    public class MediaContentPort : IMediaContentAPIs
    {
        private MediaDatabase mediaDatabase;

        private MediaInfoCommand mediaInfoCommand;

        public MediaContentPort()
        {
            mediaDatabase = new MediaDatabase();
            mediaDatabase.Connect();

            mediaInfoCommand = new MediaInfoCommand(mediaDatabase);
        }

        public async Task<IEnumerable<MediaItem>> GetAllVideoItemListAsync()
        {
            var itemList = new List<MediaItem>();

            return itemList;
        }
    }
}

```

- 더 자세한 정보는 아래 링크에서 확인 가능

[Tizen.Content.MediaContent.MediaDatabase](https://developer.tizen.org/dev-guide/csapi/api/Tizen.Content.MediaContent.MediaDatabase.html)

[Tizen.Content.MediaContent.MediaInfoCommand](https://developer.tizen.org/dev-guide/csapi/api/Tizen.Content.MediaContent.MediaInfoCommand.html)



**Step 4: GetAllVideoItemListAsync() 구현 - 비디오 정보 가져오기 및 리스트에 저장**

MediaInfoCommand의 SelectMedia 메소드를 사용하여 비디오 정보 가져온 후 itemList에 저장

미디어 중 비디오 관련 정보만 가져오기 위하여 SelectArgument에 VIDEO_FILTER 적용

_[MediaContentPort.cs (Tizen)]_

<highlight>3,14,27, 29, 31-51</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Diagnostics;
...

namespace VideoPlayerLite.Tizen.Tizen.TV.Port
{
    public class MediaContentPort : IMediaContentAPIs
    {
        private MediaDatabase mediaDatabase;

        private MediaInfoCommand mediaInfoCommand;

        private static readonly string VIDEO_FILTER = "MEDIA_TYPE=1";

        public MediaContentPort()
        {
            mediaDatabase = new MediaDatabase();
            mediaDatabase.Connect();

            mediaInfoCommand = new MediaInfoCommand(mediaDatabase);
        }

        public async Task<IEnumerable<MediaItem>> GetAllVideoItemListAsync()
        {
            var itemList = new List<MediaItem>();
            var selectArguments = new SelectArguments();

            selectArguments.FilterExpression = VIDEO_FILTER;

            try
            {
                var reader = mediaInfoCommand.SelectMedia(selectArguments);

                while (reader.Read())
                {
                    var videoInformation = reader.Current as VideoInfo;
                    itemList.Add(
                        new MediaItem()
                        {
                            Title = videoInformation.Title,
                            Path = videoInformation.Path,
                            Duration = videoInformation.Duration
                        });
                }
            }
            catch (Exception exception)
            {
                Debug.WriteLine(exception.Message);
                return itemList;
            }

            return itemList;
        }
    }
}

```

- 더 자세한 정보는 아래 링크에서 확인 가능

[Tizen Developers - Media Content](https://developer.tizen.org/ko/development/guides/.net-application/media-and-camera/media-content-and-metadata/media-content?langswitch=ko)



**Step 5: GetThumbnailPathAsync() 구현 - 썸네일 정보 생성 및 가져오기**

이미 썸네일 정보가 없는 경우, MediaInfoCommand의 CreateThumbnailAsync 메소드를 사용하여 썸네일 정보 생성

*[MediaContentPort.cs (Tizen)] *final code\*\*

<highlight>28-45,66</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Tizen.Content.MediaContent;
using VideoPlayerLite.Models;

namespace VideoPlayerLite.Tizen.Tizen.TV.Port
{
    public class MediaContentPort : IMediaContentAPIs
    {
        private MediaDatabase mediaDatabase;

        private MediaInfoCommand mediaInfoCommand;

        private static readonly string VIDEO_FILTER = "MEDIA_TYPE=1";

        public MediaContentPort()
        {
            mediaDatabase = new MediaDatabase();
            mediaDatabase.Connect();

            mediaInfoCommand = new MediaInfoCommand(mediaDatabase);
        }

        private async Task<string> GetThumbnailPathAsync(VideoInfo information)
        {
            var path = information.ThumbnailPath;

            if (String.IsNullOrEmpty(path))
            {
                try
                {
                    path = await mediaInfoCommand.CreateThumbnailAsync(information.Id);
                }
                catch (Exception e)
                {
                    Debug.WriteLine(e.Message);
                }
            }

            return path;
        }

        public async Task<IEnumerable<MediaItem>> GetAllVideoItemListAsync()
        {
            var itemList = new List<MediaItem>();
            var selectArguments = new SelectArguments();

            selectArguments.FilterExpression = VIDEO_FILTER;

            try
            {
                var reader = mediaInfoCommand.SelectMedia(selectArguments);

                while (reader.Read())
                {
                    var videoInformation = reader.Current as VideoInfo;
                    itemList.Add(
                        new MediaItem()
                        {
                            Title = videoInformation.Title,
                            Path = videoInformation.Path,
                            Thumbnail = await GetThumbnailPathAsync(videoInformation),
                            Duration = videoInformation.Duration
                        });
                }
            }
            catch (Exception exception)
            {
                Debug.WriteLine(exception.Message);
                return itemList;
            }

            return itemList;
        }
    }
}

```



본 강의에서는 Android쪽 코드에 대한 설명은 건너뛰도록 하겠습니다.

Android쪽 Port 코드도 해당 플랫폼의 방식에 따라 구현하면 됩니다.

[MediaContentPort.cs (Android)](https://s3-us-west-1.amazonaws.com/tizenschool/95/MediaContentPort.cs)



## 5. DependencyService 등록 및 MediaItemProvider 구현

이제 DependencyService를 이용하여 MediaContenPort에서 저장한 MediaItem 리스트를 공용 코드에서 사용 가능하도록 해줍니다.

방금 구현한 MediaContentPort를 DependencyService에 등록하고, 이를 MediaItemProvider에서 사용하여 MediaItem 리스트를 가져오겠습니다.

<img src="/assets/images/tutorials/95/00_appmodel_2_4_Model_DependencyService_MediaItemProvider.png" style="height:425px; width:1000px"/>



**<DependencyService 란?>**

Xamarin.Forms의 **DependencyService** 는 공용 코드에서 플랫폼 종속된 기능들을 불러올 수 있게 해줍니다.

이를 통해서 Xamarin.Forms 앱들은 각 플랫폼의 네이티브 앱들이 할 수 있는 모든 것들을 할 수 있게 됩니다.



DepencyService를 사용하기 위해서는 아래와 같은 과정이 필요합니다.



- 더 자세한 정보는 아래 링크에서 확인 가능

[Introduction to DependencyService](https://developer.xamarin.com/guides/xamarin-forms/application-fundamentals/dependency-service/introduction/)



아래 그림은 본 앱에서 DependencyService의 역할을 보여줍니다.

<img src="/assets/images/tutorials/95/00_DependencyService_Overview_ex.png" style="height:337px; width:570px"/>



**Step 1: DependencyService 등록**

먼저 타이젠 쪽에서 구현된 MediaContentPort를 DependencyService에 등록하여 공용 코드에서 사용할 수 있도록 해줍니다.

*[VideoPlayerLite.Tizen.Tizen.TV.cs] *final code\*\*

<highlight>2,4,17</highlight>

```csharp
using System;
using VideoPlayerLite.Tizen.Tizen.TV.Port;

namespace VideoPlayerLite.Tizen.Tizen.TV
{
    class Program : global::Xamarin.Forms.Platform.Tizen.FormsApplication
    {
        protected override void OnCreate()
        {
            base.OnCreate();
            LoadApplication(new App());
        }

        static void Main(string[] args)
        {
            var app = new Program();
            global::Xamarin.Forms.DependencyService.Register<MediaContentPort>();
            global::Xamarin.Forms.Platform.Tizen.Forms.Init(app);
            app.Run(args);
        }
    }
}

```



이제 MediaItemProvider에서 실제 Dependency.Get<Interface>를 통해 MediaItem 리스트를 가져오겠습니다.



**Step 2: MediaItemProvider 구현 - MediaItemProvider 클래스 생성**

등록된 DependencyService를 사용하기 위하여 Model에 MediaItemProvider 클래스를 추가로 생성합니다.

<img src="/assets/images/tutorials/95/09_01.png" style="height:212px; width:167px"/>



Make MediaItemProvider as a public class.

_[MediaItemProvider.cs]_

<highlight>9</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace VideoPlayerLite.Models
{
    public class MediaItemProvider
    {
    }
}

```



**Step 3: MediaItemProvider 구현 - Singleton 패턴 구현**

MediaItemProvider을 싱글 인스턴스로만 사용하기 위하여 Lazy Initialization을 통해 Singleton 패턴을 구현

_[MediaItemProvider.cs]_

<highlight>5,7,8</highlight>

```csharp
...

namespace VideoPlayerLite.Models
{
    public sealed class MediaItemProvider
    {
        private static readonly Lazy<MediaItemProvider> lazy = new Lazy<MediaItemProvider>(() => new MediaItemProvider());
        public static MediaItemProvider Instance { get => lazy.Value; }
    }
}

```

- For more information, refer to the link below.

[Implementing Singleton in C#](https://msdn.microsoft.com/en-us/library/ff650316.aspx)

[Lazy Initialization (초기화 지연)](<https://msdn.microsoft.com/library/dd997286(v=vs.110).aspx>)



**Step 3: MediaItemProvider 구현 - Dependency Service 호출**

Contructor에서 DependencyService의 Get() 함수를 이용하여 등록된 인터페이스 호출

_[MediaItemProvider.cs]_

<highlight>2,11,13-19</highlight>

```csharp
...
using Xamarin.Forms;

namespace VideoPlayerLite.Models
{
    public sealed class MediaItemProvider
    {
        private static readonly Lazy<MediaItemProvider> lazy = new Lazy<MediaItemProvider>(() => new MediaItemProvider());
        public static MediaItemProvider Instance { get => lazy.Value; }

        private static IMediaContentAPIs mediaContentAPIs;

        private MediaItemProvider()
        {
            if (DependencyService.Get<IMediaContentAPIs>() != null)
            {
                mediaContentAPIs = DependencyService.Get<IMediaContentAPIs>();
            }
        }
    }
}

```



**Step 4: MediaItemProvider 구현 - itemList 업데이트**

GetAllVideoItemListAsync() 함수를 불러 itemList를 업데이트

*[MediaItemProvider.cs] *final code\*\*

<highlight>17,18,28-31</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Xamarin.Forms;

namespace VideoPlayerLite.Models
{
    public sealed class MediaItemProvider
    {
        private static readonly Lazy<MediaItemProvider> lazy = new Lazy<MediaItemProvider>(() => new MediaItemProvider());
        public static MediaItemProvider Instance { get => lazy.Value; }

        private static IMediaContentAPIs mediaContentAPIs;

        private IEnumerable<MediaItem> itemList;
        public IEnumerable<MediaItem> ItemList { get => itemList; }

        private MediaItemProvider()
        {
            if (DependencyService.Get<IMediaContentAPIs>() != null)
            {
                mediaContentAPIs = DependencyService.Get<IMediaContentAPIs>();
            }
        }

        public async Task Update()
        {
            itemList = await mediaContentAPIs.GetAllVideoItemListAsync();
        }
    }
}


```



[코드 스냅샷](https://s3-us-west-1.amazonaws.com/tizenschool/95/VideoPlayerLite1_04_LibraryPage_Model.zip)



# V. LibraryPage ViewModel

## 1. LibraryPage ViewModel 개요

ViewModel은 View와 Model을 바인딩하는 역할을 하며 바인드된 속성들에 변화가 있을 때 View에 알리고, View 로직을 처리합니다.

<img src="/assets/images/tutorials/95/00_appmodel_3_LibraryPage_ViewModel.png" style="height:425px; width:1000px"/>



<br/>아래 그림은 View와 ViewModel 그리고 Model 간의 전체적인 관계를 설명합니다.

<img src="/assets/images/tutorials/95/00_LibraryPage_ViewModel.png" style="height:552px; width:1100px"/>

## 2. ViewModelBase Class 구현

우선 이 앱에서 구현될 3가지 ViewModel에서 공통적으로 쓰이게 될 ViewModelBase를 구현하겠습니다.

<img src="/assets/images/tutorials/95/00_ViewModelBase.png" style="height:164px; width:773px"/>



**Step 1: ViewModel 폴더 및 ViewModelBase 클래스 파일 생성**

VideoPlayerLite project에 우 클릭 후, **추가** > **새 폴더** 선택 ( **ViewModels** 로 명명)

ViewModels 폴더에 우 클릭 후, **추가** > **새 항목** 선택

**클래스** 선택 후 **추가** 클릭 ( **ViewModelBase.cs** 로 명명)

<img src="/assets/images/tutorials/95/09_02.png" style="height:212px; width:167px"/>



**Step 2: INotifyPropertyChanged 구현**

ViewModelBase에서 Property값이 변경되었음을 알려주는 INotifyPropertyChanged 인터페이스 구현

*[ViewModelBase.cs] *final code\*\*

<highlight>3,4,9,13,15-18</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Runtime.CompilerServices;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace VideoPlayerLite.ViewModels
{
    public class ViewModelBase : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler PropertyChanged;

        protected void InvokePropertyChanged([CallerMemberName] string propertyName = null)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }
    }
}

```

- 더 자세한 정보는 아래 링크에서 확인 가능

[INotifyPropertyChanged 인터페이스](<https://msdn.microsoft.com/ko-kr/library/system.componentmodel.inotifypropertychanged(v=vs.110).aspx>)

[How to: Implement Property Change Notification](https://docs.microsoft.com/en-us/dotnet/framework/wpf/data/how-to-implement-property-change-notification)

[MethodBase.Invoke Method](<https://msdn.microsoft.com/en-us/library/a89hcwhh(v=vs.110).aspx>)



이제부터 각 ViewModel 구현 시, 이 ViewModelBase 클래스를 상속받아 재사용할 수 있습니다.

## 3. LibraryPageViewModel Class 구현

**Step 1:  LibraryPageViewModel 클래스 생성**

ViewModels 폴더에 새로운 **클래스** 를 추가 후, " **LibraryPageViewModel.cs** "라고 명명

<img src="/assets/images/tutorials/95/09_03.png" style="height:212px; width:167px"/>



**Step 2:  ViewModelBase 클래스 상속**

LibraryPageViewModel을 public 클래스로 변경 후, ViewModelBase 클래스 상속

_[LibraryPageViewModel.cs]_

<highlight>9</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace VideoPlayerLite.ViewModels
{
    public class LibraryPageViewModel : ViewModelBase
    {
    }
}

```



**Step 2:  VideoList 프로퍼티 추가**

LibraryPage에 바인딩 시킬 VideoList 프로퍼티 추가

_[LibraryPageViewModel.cs]_

<highlight>2,8,10-18</highlight>

```csharp
...
using VideoPlayerLite.Models;

namespace VideoPlayerLite.ViewModels
{
    public class LibraryPageViewModel : ViewModelBase
    {
        private IEnumerable<MediaItem> videoList;

        public IEnumerable<MediaItem> VideoList
        {
            get => videoList;
            private set
            {
                videoList = value;
                InvokePropertyChanged();
            }
        }
    }
}

```



**Step 4:  UpdateVideoListCommand 커멘드 추가**

MediaItemProvider로부터 리스트를 받아 VideoList에 넘겨주는 UpdateItemList() 함수 구현 후,

View에 이를 요청하기 위한 UpdateVideoListCommand 커멘드 추가

*[LibraryPageViewModel.cs] *final code\*\*

<highlight>7,25,27-35,37-41,43-46</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using VideoPlayerLite.Models;
using Xamarin.Forms;

namespace VideoPlayerLite.ViewModels
{
    public class LibraryPageViewModel : ViewModelBase
    {
        private IEnumerable<MediaItem> videoList;

        public IEnumerable<MediaItem> VideoList
        {
            get => videoList;
            private set
            {
                videoList = value;
                InvokePropertyChanged();
            }
        }

        private Command updateVideoListCommand;

        public Command UpdateVideoListCommand
        {
            get => updateVideoListCommand;
            set
            {
                updateVideoListCommand = value;
                InvokePropertyChanged();
            }
        }

        private async void UpdateItemList()
        {
            await MediaItemProvider.Instance.Update();
            VideoList = MediaItemProvider.Instance.ItemList;
        }

        public LibraryPageViewModel()
        {
            UpdateVideoListCommand = new Command(() => UpdateItemList());
        }

    }
}

```



## 4. View/ViewModel 간 Binding 설정

마지막으로 View와 ViewModel을 바인딩 시키도록 하겠습니다.



**Step 1: BindableProperties 생성**

VideoList를 바인딩 시키기 위한 BindableProperty와 UpdateVideoListCommand를 바인딩 시키기 위한 BindableProperty를 생성

_[LibraryPage.xaml.cs]_

<highlight>6,15,17-20,22,24-27</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using VideoPlayerLite.Models;
using Xamarin.Forms;
using Xamarin.Forms.Xaml;

namespace VideoPlayerLite.Views
{
	[XamlCompilation(XamlCompilationOptions.Compile)]
	public partial class LibraryPage : ContentPage
	{
        public static readonly BindableProperty VideoListProperty = BindableProperty.Create("VideoList", typeof(IEnumerable<MediaItem>), typeof(LibraryPage), null);

        public IEnumerable<MediaItem> VideoList
        {
            get { return (IEnumerable<MediaItem>)GetValue(VideoListProperty); }
        }

        public static readonly BindableProperty UpdateVideoListCommandProperty = BindableProperty.Create("UpdateVideoListCommand", typeof(Command), typeof(LibraryPage), null);

        public Command UpdateVideoListCommand
        {
            get { return (Command)GetValue(UpdateVideoListCommandProperty); }
        }

        public LibraryPage ()
		{
			InitializeComponent ();
		}
	}
}

```

- 더 자세한 정보는 아래 링크에서 확인 가능

[Xamarin.Forms Bindable Properties](https://developer.xamarin.com/guides/xamarin-forms/xaml/bindable-properties/)



**Step 2: UpdateGridItems & PropertyChanged 구현**

GridView에 Button형식으로 VideoList를 보여주기 위한 UpdateGridItems 함수 구현 후,

바인딩된 프로퍼티들이 변경되었을 때  UpdateGridItems가 호출될 수 있도록 PropertyChanged 함수 구현

_[LibraryPage.xaml.cs]_

<highlight>22-28,30-41,46</highlight>

```csharp
...

namespace VideoPlayerLite.Views
{
	[XamlCompilation(XamlCompilationOptions.Compile)]
	public partial class LibraryPage : ContentPage
	{
        public static readonly BindableProperty VideoListProperty = BindableProperty.Create("VideoList", typeof(IEnumerable<MediaItem>), typeof(LibraryPage), null);

        public IEnumerable<MediaItem> VideoList
        {
            get { return (IEnumerable<MediaItem>)GetValue(VideoListProperty); }
        }

        public static readonly BindableProperty UpdateVideoListCommandProperty = BindableProperty.Create("UpdateVideoListCommand", typeof(Command), typeof(LibraryPage), null);

        public Command UpdateVideoListCommand
        {
            get { return (Command)GetValue(UpdateVideoListCommandProperty); }
        }

        private void OnPropertyChanged(object sender, System.ComponentModel.PropertyChangedEventArgs e)
        {
            if (e.PropertyName == VideoListProperty.PropertyName)
            {
                UpdateGridItems();
            }
        }

        private void UpdateGridItems()
        {
            var index = 0;

            GridView.Children.Clear();

            foreach (var item in VideoList)
            {
                GridView.Children.Add(new Button() { Text = item.Title }, index / 3, index % 3);
                index++;
            }
        }

        public LibraryPage ()
		{
			InitializeComponent ();
            PropertyChanged += OnPropertyChanged;
        }
	}
}

```



**Step 3: OnAppearing 함수 치환**

LibraryPage가 스크린에 보일 때, UpdateVideoListCommand가 실행되어 리스트를 업데이트 하도록 OnAppearing 함수 치환(override)

_[LibraryPage.xaml.cs]_

<highlight>15,52-60,65</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using VideoPlayerLite.Models;
using Xamarin.Forms;
using Xamarin.Forms.Xaml;

namespace VideoPlayerLite.Views
{
	[XamlCompilation(XamlCompilationOptions.Compile)]
	public partial class LibraryPage : ContentPage
	{
        private bool isLoaded;

        public static readonly BindableProperty VideoListProperty = BindableProperty.Create("VideoList", typeof(IEnumerable<MediaItem>), typeof(LibraryPage), null);

        public IEnumerable<MediaItem> VideoList
        {
            get { return (IEnumerable<MediaItem>)GetValue(VideoListProperty); }
        }

        public static readonly BindableProperty UpdateVideoListCommandProperty = BindableProperty.Create("UpdateVideoListCommand", typeof(Command), typeof(LibraryPage), null);

        public Command UpdateVideoListCommand
        {
            get { return (Command)GetValue(UpdateVideoListCommandProperty); }
        }

        private void OnPropertyChanged(object sender, System.ComponentModel.PropertyChangedEventArgs e)
        {
            if (e.PropertyName == VideoListProperty.PropertyName)
            {
                UpdateGridItems();
            }
        }

        private void UpdateGridItems()
        {
            var index = 0;

            GridView.Children.Clear();

            foreach (var item in VideoList)
            {
                GridView.Children.Add(new Button(){ Text = item.Title }, index / 3, index % 3);
                index++;
            }
        }

        protected override void OnAppearing()
        {
            base.OnAppearing();
            if (!isLoaded)
            {
                UpdateVideoListCommand.Execute(null);
                isLoaded = true;
            }
        }

        public LibraryPage ()
		{
			InitializeComponent ();
            isLoaded = false;
            PropertyChanged += OnPropertyChanged;
        }
	}
}

```

- 더 자세한 정보는 아래 링크에서 확인 가능

[Xamarin.Forms.Page.OnAppearing](https://developer.xamarin.com/api/member/Xamarin.Forms.Page.OnAppearing/)



**Step 4: BindingContext 설정**

ContentPage의 BindingContext를 LibraryPageViewModel로 설정

_[LibraryPage.xaml]_

<highlight>4,7-9</highlight>

```xml
<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:ViewModels="clr-namespace:VideoPlayerLite.ViewModels"
             x:Class="VideoPlayerLite.Views.LibraryPage">

    <ContentPage.BindingContext>
        <ViewModels:LibraryPageViewModel/>
    </ContentPage.BindingContext>

    <ContentPage.Content>
    ...
    </ContentPage.Content>
</ContentPage>

```

- 더 자세한 정보는 아래 링크에서 확인 가능

[XAML Data Binding Basics](https://developer.xamarin.com/guides/xamarin-forms/xaml/xaml-basics/data_binding_basics/)



**Step 5: 프로퍼티 바인딩**

VideoList 프로퍼티와 UpdateVideoListCommand 프로퍼티 바인딩 설정

*[LibraryPage.xaml] *final code\*\*

<highlight>6-7</highlight>

```xml
<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:ViewModels="clr-namespace:VideoPlayerLite.ViewModels"
             x:Class="VideoPlayerLite.Views.LibraryPage"
             VideoList="{Binding VideoList}"
             UpdateVideoListCommand="{Binding UpdateVideoListCommand}">
    <ContentPage.BindingContext>
        <ViewModels:LibraryPageViewModel/>
    </ContentPage.BindingContext>
    <ContentPage.Content>
        <RelativeLayout RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=1}"
                        RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}">
            <Label Text="Video Player Lite"
                   FontAttributes="Bold"
                   FontSize="Large"
                   HorizontalOptions="Center"
                   VerticalOptions="End"
                   RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.185}"
                   RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}"/>
            <ScrollView RelativeLayout.YConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.3}"
                        RelativeLayout.XConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.05}"
                        RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.55}"
                        RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.95}"
                        Orientation="Horizontal">
                <Grid x:Name="GridView"
                      HorizontalOptions="Start">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                </Grid>
            </ScrollView>
        </RelativeLayout>
    </ContentPage.Content>
</ContentPage>

```



[코드 스냅샷](https://s3-us-west-1.amazonaws.com/tizenschool/95/VideoPlayerLite1_05_LibraryPage_FINAL.zip)

## 5. Emulator 내 비디오 파일 추가 및 LibraryPage 최종 확인

기본 Emulator에는 비디오 파일이 포함되어있지 않기 때문에 본 강의의 앱을 제대로 보려면 비디오 파일을 추가해주어야합니다.



XXX때문에 encoding되어 가장 최적화된 샘플 비디오 파일들을 첨부하였습니다.

[샘플 비디오 파일 모음](https://s3-us-west-1.amazonaws.com/tizenschool/95/sample_video_files.zip)



Emulator 스크린에 비디오 파일  **Drag & Drop**

**<img src="/assets/images/tutorials/95/11_01.png" style="height:321px; width:1001px"/>**



저장 디렉토리를 **/home/owner/media/Videos** 로 변경

<img src="/assets/images/tutorials/95/11_02.png" style="height:378px; width:756px"/>



로딩이 끝나면 Emulator **종료 & 재시작**

**<img src="/assets/images/tutorials/95/11_03.png" style="height:371px; width:756px"/>**



**ctrl + F5** 를 눌러 프로젝트 빌드

**아래 스크린이 확인되면 성공!**

**<img src="/assets/images/tutorials/95/11_04.png" style="height:371px; width:756px"/>**





# VI. ItemView View

## 1. ItemView View 개요

이번에는 LibraryPage 내 썸네일 이미지, 타이틀 등을 아이콘 형태로 보여주는 ItemView를 만들어보겠습니다.

<img src="/assets/images/tutorials/95/00_screen_0_all.png" style="height:390px; width:922px"/>



<img src="/assets/images/tutorials/95/00_appmodel_4_ItemView_View.png" style="undefined"/>

## 2. ItemView View 구현

**Step 1: ItemView 추가**

Views 폴더에 우 클릭 후, **추가** > **새 항목**  선택하여 새로운 **Content View** 추가

새로운 Content View는 " **ItemView** "라 명명

<img src="/assets/images/tutorials/95/12_01.png" style="height:392px; width:567px"/>

<img src="/assets/images/tutorials/95/12_02.png" style="height:282px; width:167px"/>



**Step 2: View 타입 변경**

XAML 코드와 Code-Behind 코드에서 ContentView를 RelativeLayout으로 변경

_[ItemView.xaml]_

<highlight>2-5</highlight>

```xml
<?xml version="1.0" encoding="UTF-8"?>
<RelativeLayout xmlns="http://xamarin.com/schemas/2014/forms"
                xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                x:Class="VideoPlayerLite.Views.ItemView">
</RelativeLayout>

```

_[ItemView.xaml.cs]_

<highlight>13</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

using Xamarin.Forms;
using Xamarin.Forms.Xaml;

namespace VideoPlayerLite.Views
{
	[XamlCompilation(XamlCompilationOptions.Compile)]
	public partial class ItemView : RelativeLayout
	{
		public ItemView ()
		{
			InitializeComponent ();
		}
	}
}

```



**Step 3: ItemView에 필요 요소 추가**

ItemView에 필요한 요소들 (Image, Label, Button) 추가

Image와 Label에는 비디오의 썸네일과 타이틀 표시, 그리고 버튼은 Focused와 Clicked 같은 이벤트 처리를 위해 필요

_[ItemView.xaml]_

<highlight>5-21</highlight>

```xml
<?xml version="1.0" encoding="utf-8" ?>
<RelativeLayout xmlns="http://xamarin.com/schemas/2014/forms"
                xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                x:Class="VideoPlayerLite.Views.ItemView"
                HorizontalOptions="Start">
    <Image x:Name="ThumbnailImage"
           RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Height, Factor=0.95}"
           RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Width, Factor=0.96}"
           RelativeLayout.YConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Height, Factor=0.025}"
           RelativeLayout.XConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Width, Factor=0.02}"
           Aspect="AspectFill"/>
    <Label x:Name="Title"
           RelativeLayout.YConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.7}"
           RelativeLayout.XConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.07}"
           RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Width, Factor=0.86}"
           TextColor="White"
           LineBreakMode="TailTruncation"/>
    <Button x:Name="FocusButton"
            RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Height, Factor=0.95}"
            RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Width, Factor=0.96}"
            Opacity="0"/>
</RelativeLayout>

```



ItemView의 버튼이 focused 되었을 때, 하이라이트 효과를 주기위하여 BoxView 추가

BoxView의 IsVisible 프로퍼티와 Button의 IsFocused 프로퍼티를 연결

*[ItemView.xaml]  *final code\*\*

<highlight>6-10</highlight>

```xml
<?xml version="1.0" encoding="UTF-8"?>
<RelativeLayout xmlns="http://xamarin.com/schemas/2014/forms"
                xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                x:Class="VideoPlayerLite.Views.ItemView"
                HorizontalOptions="Start">
    <BoxView x:Name="BackgroundView"
             RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=1}"
             RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}"
             BackgroundColor="White"
             IsVisible="{Binding Path=IsFocused, Source={x:Reference Name=FocusButton}}"/>
    <Image x:Name="ThumbnailImage"
           RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Height, Factor=0.95}"
           RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Width, Factor=0.96}"
           RelativeLayout.YConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Height, Factor=0.025}"
           RelativeLayout.XConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Width, Factor=0.02}"
           Aspect="AspectFill"/>
    <Label x:Name="Title"
           RelativeLayout.YConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.7}"
           RelativeLayout.XConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.07}"
           RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Width, Factor=0.86}"
           TextColor="White"
           LineBreakMode="TailTruncation"/>
    <Button x:Name="FocusButton"
            RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Height, Factor=0.95}"
            RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Width, Factor=0.96}"
            Opacity="0"/>
</RelativeLayout>

```



**Step 4: OnSizeAllocated 함수 치환**

RelativeLayout의 너비가 높이에 따라 변경되도록 OnSizeAllocated 함수 치환

*[ItemView.xaml.cs]*final code\*\*

<highlight>20-26</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

using Xamarin.Forms;
using Xamarin.Forms.Xaml;

namespace VideoPlayerLite.Views
{
	[XamlCompilation(XamlCompilationOptions.Compile)]
	public partial class ItemView : RelativeLayout
	{
		public ItemView ()
		{
			InitializeComponent ();
		}

        protected override void OnSizeAllocated(double width, double height)
        {
            base.OnSizeAllocated(width, height);

            WidthRequest = height * 1.5f;
            InvalidateMeasure();
        }
    }
}

```

- 더 자세한 정보는 아래 링크에서 확인 가능

[Xamarin.Forms.Layout.OnSizeAllocated](https://developer.xamarin.com/api/member/Xamarin.Forms.Layout.OnSizeAllocated/p/System.Double/System.Double/)



[코드 스냅샷](https://s3-us-west-1.amazonaws.com/tizenschool/95/VideoPlayerLite1_06_ItemView_View.zip)

# VII. ItemView ViewModel

## 1. ItemView ViewModel 개요

이제 본 강좌의 마지막 단계로 ItemView의 ViewModel을 만들겠습니다.

<img src="/assets/images/tutorials/95/00_appmodel_5_ItemView_ViewModel.png" style="undefined"/>

## 2. ItemView ViewModel 구현

**Step 1: ItemViewModel 추가**

Views 폴더에 우 클릭 후, **추가** > **새 항목**  선택하여 새로운 **Class** 추가

새로운 class는 " **ItemViewModel** "라 명명

<img src="/assets/images/tutorials/95/13_01.png" style="height:282px; width:167px"/>



**Step 2:  ViewModelBase 클래스 상속**

ItemViewModel을 public 클래스로 변경 후, ViewModelBase 클래스 상속

_[ItemViewModel.cs]_

<highlight>9</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace VideoPlayerLite.ViewModels
{
    public class ItemViewModel : ViewModelBase
    {
    }
}

```



**Step 3:  VideoItem 프로퍼티 추가**

ItemView에 바인딩 시킬 VideoItem 프로퍼티 추가

*[ItemViewModel.cs] *final code\*\*

<highlight>6,12,14-22,24-27</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using VideoPlayerLite.Models;

namespace VideoPlayerLite.ViewModels
{
    public class ItemViewModel : ViewModelBase
    {
        private MediaItem videoItem;

        public MediaItem VideoItem
        {
            get => videoItem;
            set
            {
                videoItem = value;
                InvokePropertyChanged();
            }
        }

        public ItemViewModel(MediaItem item)
        {
            VideoItem = item;
        }
    }
}


```





## 3. View/ViewModel 간 Binding 설정

마지막으로 ItemView의 View와 ViewModel을 바인딩 시키도록 하겠습니다.



**Step 1: BindingContext 설정**

ItemView의 constructor에서 item에 대한 ItemViewModel 인스턴스를 생성하여 BindingContext로 설정

*[ItemView.xaml.cs] *final code\*\*

<highlight>6,7,16,20</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using VideoPlayerLite.Models;
using VideoPlayerLite.ViewModels;
using Xamarin.Forms;
using Xamarin.Forms.Xaml;

namespace VideoPlayerLite.Views
{
	[XamlCompilation(XamlCompilationOptions.Compile)]
	public partial class ItemView : RelativeLayout
	{
        public ItemView(MediaItem item)
        {
            InitializeComponent();

            BindingContext = new ItemViewModel(item);
        }

        protected override void OnSizeAllocated(double width, double height)
        {
            base.OnSizeAllocated(width, height);

            WidthRequest = height * 1.5f;
            InvalidateMeasure();
        }
    }
}

```



**Step 2: LibraryPage 내 ItemView 생성**

LibraryPage의 UpdateGridItems 함수에서 버튼 대신 ItemView를 생성하도록 변경

*[LibraryPage.xaml.cs] *final code\*\*

<highlight>47</highlight>

```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using VideoPlayerLite.Models;
using Xamarin.Forms;
using Xamarin.Forms.Xaml;

namespace VideoPlayerLite.Views
{
	[XamlCompilation(XamlCompilationOptions.Compile)]
	public partial class LibraryPage : ContentPage
	{
        private bool isLoaded;

        public static readonly BindableProperty VideoListProperty = BindableProperty.Create("VideoList", typeof(IEnumerable<MediaItem>), typeof(LibraryPage), null);

        public IEnumerable<MediaItem> VideoList
        {
            get { return (IEnumerable<MediaItem>)GetValue(VideoListProperty); }
        }

        public static readonly BindableProperty UpdateVideoListCommandProperty = BindableProperty.Create("UpdateVideoListCommand", typeof(Command), typeof(LibraryPage), null);

        public Command UpdateVideoListCommand
        {
            get { return (Command)GetValue(UpdateVideoListCommandProperty); }
        }

        private void OnPropertyChanged(object sender, System.ComponentModel.PropertyChangedEventArgs e)
        {
            if (e.PropertyName == VideoListProperty.PropertyName)
            {
                UpdateGridItems();
            }
        }

        private void UpdateGridItems()
        {
            var index = 0;

            GridView.Children.Clear();

            foreach (var item in VideoList)
            {
                GridView.Children.Add(new ItemView(item), index / 3, index % 3);
                index++;
            }
        }

        protected override void OnAppearing()
        {
            base.OnAppearing();
            if (!isLoaded)
            {
                UpdateVideoListCommand.Execute(null);
                isLoaded = true;
            }
        }

        public LibraryPage ()
		{
			InitializeComponent ();
            isLoaded = false;
            PropertyChanged += OnPropertyChanged;
        }
	}
}

```



**Step 3: 프로퍼티 바인딩**

VideoItem의 썸네일과 Title에 대한 프로퍼티 바인딩 설정

*[ItemView.xaml] *final code\*\*

<highlight>16,23</highlight>

```xml
<?xml version="1.0" encoding="UTF-8"?>
<RelativeLayout xmlns="http://xamarin.com/schemas/2014/forms"
                xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                x:Class="VideoPlayerLite.Views.ItemView"
                HorizontalOptions="Start">
    <BoxView x:Name="BackgroundView"
             RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=1}"
             RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}"
             BackgroundColor="White"
             IsVisible="{Binding Path=IsFocused, Source={x:Reference Name=FocusButton}}"/>
    <Image x:Name="ThumbnailImage"
           RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Height, Factor=0.95}"
           RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Width, Factor=0.96}"
           RelativeLayout.YConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Height, Factor=0.025}"
           RelativeLayout.XConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Width, Factor=0.02}"
           Source="{Binding VideoItem.Thumbnail}"
           Aspect="AspectFill"/>
    <Label x:Name="Title"
           RelativeLayout.YConstraint="{ConstraintExpression Type=RelativeToParent, Property=Height, Factor=0.7}"
           RelativeLayout.XConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.07}"
           RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Width, Factor=0.86}"
           TextColor="White"
           Text="{Binding VideoItem.Title}"
           LineBreakMode="TailTruncation"/>
    <Button x:Name="FocusButton"
            RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Height, Factor=0.95}"
            RelativeLayout.WidthConstraint="{ConstraintExpression Type=RelativeToView, ElementName=BackgroundView, Property=Width, Factor=0.96}"
            Opacity="0"/>
</RelativeLayout>

```



[코드 스냅샷](http://tizenschool.orghttps://s3-us-west-1.amazonaws.com/tizenschool/95/VideoPlayerLite1_07_ItemView_FINAL.zip)



## 4. Tizen Privilege 추가 및 ItemView 최종 확인

Tizen에서 썸네일 이미지를 생성하기 위해서는  http://tizen.org/privilege/mediastorage Privilege가 필요합니다.

Tizen 프로젝트 tizen-manifest.xml 파일의 Privileges 탭에서 추가해줍니다.



**Privileges** 탭 선택 > **Add** 클릭

**mediastorage** 검색 > **OK** 클릭

<img src="/assets/images/tutorials/95/13_02.png" style="height:567px; width:586px"/>



**ctrl + F5** 를 눌러 프로젝트 빌드

**아래 스크린이 확인되면 성공!**

<img src="/assets/images/tutorials/95/20_01.png" style="height:371px; width:756px"/>
